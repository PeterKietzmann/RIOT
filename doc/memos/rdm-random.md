
- RDM: rdm-random.md
- Title: Random architecture
- Author: Peter Kietzmann
- Status: draft
- Type: Design
- Created: February 2019

## Abstract

This memo proposes an update to the current [random](https://riot-os.org/api/group__sys__random.html) architecture in RIOT.

## Status

This initial version of the RDM presents planned changes to the random infrastructure and acts as a place to (i) find consensus about these changes in the community and
(ii) document the design goals of the re-work. The content of this document is licensed with a Creative Commons CC-BY-SA license.

## Terminology

This memo uses the [RFC2119](https://www.ietf.org/rfc/rfc2119.txt) terminology
and the following acronyms:

- PUF: Physical unclonable function
- HWRNG: Hardware random number generator
- PRNG: Pseudo-random number generator
- NVM: Non-volatile memory

# 1. Introduction
The random module provides a common interface to the software PRNG. This sovereign task requires reliable entropy sources for PRNG seeding as well as mechanisms to report inadequate sources to the application programmer. In the following of this document we propose a collection of changes to improve the current situation.


# 2. Random Seed

## Entropy Source
The most common and prevalent sources for entropy on an IoT node include:

- PUF
- HWRNG
- ADC noise
- External devices like Crypto-ICs, radios with RNG, ...
- CPUID
- Deployed key in NVM

.. where the latter two don't provide entropy between to boot processes of a device. The proposed change enables the most reasonable entropy source(s) for a platform to form a seed.

## Entropy Accumulation

The proposed change adds one layer of abstraction to decapsulate entropy gathering and PRNG seeding. Furthermore, it enables entropy accumulation of varying sources, in case one source is defect. The idea of entropy collection initially popped up in [#4294](https://github.com/RIOT-OS/RIOT/pull/4294). An alternative but slightly more heavy-weight implementation can be found in the SSL library mbed TLS (1) which is included in the ARM MBED operation system. For the future we MAY implement a feature as proposed in (2). For the initial re-work we would simply pass through one entropy source of choice.

## Dependencies
TBD â€“ how to abstract board resources, entropy source prioritization and central seed generation?


## Reporting
There are certain situations in which the seed was not generated by a proper entropy source, for example (i) the device does not provide an entropy source, (ii) the entropy bases on the SRAM PUF (3) module which detected a soft-reset. In order for an application developer to check for inadequate seeding, this change proposes a seed state that can be read by a simple get function.

# 3. PRNG

## State Maintenance
A protocol implementation or security application may require to self-seed generator and to self-maintain its state. This document proposes an adoption of the random API in a way that generators can run on an external state as an alternative to the global state that is used by default.

## Parallel PRNGs
Some applications require random numbers for simple purposes such as trickle timers whereas others rely on cryptographically secure, high entropy and unpredictable sequences. Both MAY be required in parallel. This document proposes an architecture that allows for parallel PRNGs, which also implies parallel seeding. In order to make the distinction between these generator types clear for the developer, this document proposes a second API next to the existing one, which is suffixed with something like `_secure` and only implements generators that are considered "crypto-safe".


## Memory
TBD

- incorporate secure memory?
- add un-init function?
- zeroize sensitive blocks?
- all generators thread safe?

## Acknowledgements

## References
(1) [https://github.com/ARMmbed/mbedtls/blob/development/include/mbedtls/entropy.h](https://github.com/ARMmbed/mbedtls/blob/development/include/mbedtls/entropy.h)

(2) [https://datatracker.ietf.org/doc/draft-irtf-cfrg-randomness-improvements/](https://datatracker.ietf.org/doc/draft-irtf-cfrg-randomness-improvements/)

(3) [https://riot-os.org/api/puf__sram_8h.html](https://riot-os.org/api/puf__sram_8h.html)


## Revision

- Rev0: initial document

## Contact

The author of this memo can be contacted via email at peter.kietzmann@haw-hamburg.de
