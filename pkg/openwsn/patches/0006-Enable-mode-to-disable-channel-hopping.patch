From 27036f0cc2ff74520b0d9acdfd9ceb9ac1f8936e Mon Sep 17 00:00:00 2001
From: PeterKietzmann <peter.kietzmann@haw-hamburg.de>
Date: Thu, 15 Feb 2018 15:11:05 +0100
Subject: [PATCH 6/6] Enable mode to disable channel hopping

---
 openstack/02a-MAClow/IEEE802154E.c | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/openstack/02a-MAClow/IEEE802154E.c b/openstack/02a-MAClow/IEEE802154E.c
index e929e7d5..22fa4acf 100644
--- a/openstack/02a-MAClow/IEEE802154E.c
+++ b/openstack/02a-MAClow/IEEE802154E.c
@@ -110,8 +110,11 @@ void ieee154e_init(void) {
     // initialize variables
     memset(&ieee154e_vars,0,sizeof(ieee154e_vars_t));
     memset(&ieee154e_dbg,0,sizeof(ieee154e_dbg_t));
-    
+#if OW_RIOT_SINGLE_CHANNEL
+    ieee154e_vars.singleChannel     = OW_RIOT_SINGLE_CHANNEL;
+#else
     ieee154e_vars.singleChannel     = 0; // 0 means channel hopping
+#endif
     ieee154e_vars.isAckEnabled      = TRUE;
     ieee154e_vars.isSecurityEnabled = FALSE;
     ieee154e_vars.slotDuration      = TsSlotDuration;
@@ -536,8 +539,11 @@ port_INLINE void activity_synchronize_newSlot(void) {
         radio_rfOff();
         
         // update record of current channel
+#if OW_RIOT_SINGLE_CHANNEL
+        ieee154e_vars.freq = OW_RIOT_SINGLE_CHANNEL;
+#else
         ieee154e_vars.freq = (openrandom_get16b()&0x0F) + 11;
-        
+#endif
         // configure the radio to listen to the default synchronizing channel
         radio_setFrequency(ieee154e_vars.freq);
         
-- 
2.14.1

